CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;
CREATE TABLE amenity (
    amenity_id integer GENERATED BY DEFAULT AS IDENTITY,
    name character varying(100) NOT NULL,
    "Description" text,
    icon character varying(50),
    "CreatedDate" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_amenity" PRIMARY KEY (amenity_id)
);

CREATE TABLE hotel (
    hotel_id integer GENERATED BY DEFAULT AS IDENTITY,
    name character varying(200) NOT NULL,
    address character varying(255),
    city character varying(100),
    country character varying(100),
    description text,
    star_rating numeric(2,1) NOT NULL,
    latitude numeric(10,7),
    longitude numeric(10,7),
    phone character varying(20),
    website character varying(200),
    image_url text,
    created_date timestamp with time zone NOT NULL,
    updated_date timestamp with time zone,
    is_active boolean NOT NULL,
    CONSTRAINT "PK_hotel" PRIMARY KEY (hotel_id)
);

CREATE TABLE room_type (
    room_type_id integer GENERATED BY DEFAULT AS IDENTITY,
    hotel_id integer NOT NULL,
    name character varying(100) NOT NULL,
    description text,
    capacity integer NOT NULL,
    base_price numeric(10,2) NOT NULL,
    image_url text,
    created_date timestamp with time zone NOT NULL,
    updated_date timestamp with time zone,
    CONSTRAINT "PK_room_type" PRIMARY KEY (room_type_id),
    CONSTRAINT "FK_room_type_hotel_hotel_id" FOREIGN KEY (hotel_id) REFERENCES hotel (hotel_id) ON DELETE CASCADE
);

CREATE TABLE users (
    user_id integer GENERATED BY DEFAULT AS IDENTITY,
    email character varying(100) NOT NULL,
    password character varying(100) NOT NULL,
    first_name character varying(100),
    last_name character varying(100),
    phone_number character varying(20),
    address character varying(255),
    role character varying(20) NOT NULL DEFAULT 'Customer',
    hotel_id integer,
    created_date timestamp with time zone NOT NULL,
    updated_date timestamp with time zone,
    is_active boolean NOT NULL,
    CONSTRAINT "PK_users" PRIMARY KEY (user_id),
    CONSTRAINT "FK_users_hotel_hotel_id" FOREIGN KEY (hotel_id) REFERENCES hotel (hotel_id) ON DELETE SET NULL
);

CREATE TABLE room (
    room_id integer GENERATED BY DEFAULT AS IDENTITY,
    room_type_id integer NOT NULL,
    room_number character varying(50) NOT NULL,
    floor integer NOT NULL,
    status character varying(20) NOT NULL DEFAULT 'Available',
    created_date timestamp with time zone NOT NULL,
    updated_date timestamp with time zone,
    CONSTRAINT "PK_room" PRIMARY KEY (room_id),
    CONSTRAINT "FK_room_room_type_room_type_id" FOREIGN KEY (room_type_id) REFERENCES room_type (room_type_id) ON DELETE CASCADE
);

CREATE TABLE booking (
    booking_id integer GENERATED BY DEFAULT AS IDENTITY,
    user_id integer NOT NULL,
    room_id integer NOT NULL,
    check_in_date timestamp with time zone NOT NULL,
    check_out_date timestamp with time zone NOT NULL,
    "GuestCount" integer NOT NULL,
    total_price numeric(10,2) NOT NULL,
    status character varying(20) NOT NULL DEFAULT 'Pending',
    "SpecialRequests" text,
    created_date timestamp with time zone NOT NULL,
    updated_date timestamp with time zone,
    CONSTRAINT "PK_booking" PRIMARY KEY (booking_id),
    CONSTRAINT "FK_booking_room_room_id" FOREIGN KEY (room_id) REFERENCES room (room_id) ON DELETE RESTRICT,
    CONSTRAINT "FK_booking_users_user_id" FOREIGN KEY (user_id) REFERENCES users (user_id) ON DELETE RESTRICT
);

CREATE TABLE room_amenity (
    room_id integer NOT NULL,
    amenity_id integer NOT NULL,
    CONSTRAINT "PK_room_amenity" PRIMARY KEY (room_id, amenity_id),
    CONSTRAINT "FK_room_amenity_amenity_amenity_id" FOREIGN KEY (amenity_id) REFERENCES amenity (amenity_id) ON DELETE CASCADE,
    CONSTRAINT "FK_room_amenity_room_room_id" FOREIGN KEY (room_id) REFERENCES room (room_id) ON DELETE CASCADE
);

CREATE TABLE payment (
    payment_id integer GENERATED BY DEFAULT AS IDENTITY,
    booking_id integer NOT NULL,
    amount numeric(10,2) NOT NULL,
    payment_method character varying(50),
    "TransactionId" text,
    status character varying(20) NOT NULL DEFAULT 'Pending',
    payment_date timestamp with time zone,
    "CreatedDate" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_payment" PRIMARY KEY (payment_id),
    CONSTRAINT "FK_payment_booking_booking_id" FOREIGN KEY (booking_id) REFERENCES booking (booking_id) ON DELETE CASCADE
);

CREATE TABLE review (
    review_id integer GENERATED BY DEFAULT AS IDENTITY,
    booking_id integer NOT NULL,
    user_id integer NOT NULL,
    hotel_id integer NOT NULL,
    rating integer NOT NULL,
    "Title" text,
    comment text,
    "IsApproved" boolean NOT NULL,
    created_date timestamp with time zone NOT NULL,
    "UpdatedDate" timestamp with time zone,
    CONSTRAINT "PK_review" PRIMARY KEY (review_id),
    CONSTRAINT "FK_review_booking_booking_id" FOREIGN KEY (booking_id) REFERENCES booking (booking_id) ON DELETE CASCADE,
    CONSTRAINT "FK_review_hotel_hotel_id" FOREIGN KEY (hotel_id) REFERENCES hotel (hotel_id) ON DELETE RESTRICT,
    CONSTRAINT "FK_review_users_user_id" FOREIGN KEY (user_id) REFERENCES users (user_id) ON DELETE RESTRICT
);

INSERT INTO amenity (amenity_id, "CreatedDate", "Description", icon, name)
VALUES (1, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Free high-speed WiFi', 'wifi', 'WiFi');
INSERT INTO amenity (amenity_id, "CreatedDate", "Description", icon, name)
VALUES (2, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Climate control', 'snowflake', 'Air Conditioning');
INSERT INTO amenity (amenity_id, "CreatedDate", "Description", icon, name)
VALUES (3, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Flat-screen TV', 'tv', 'TV');
INSERT INTO amenity (amenity_id, "CreatedDate", "Description", icon, name)
VALUES (4, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'In-room mini bar', 'glass-martini', 'Mini Bar');
INSERT INTO amenity (amenity_id, "CreatedDate", "Description", icon, name)
VALUES (5, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'In-room safe', 'lock', 'Safe');
INSERT INTO amenity (amenity_id, "CreatedDate", "Description", icon, name)
VALUES (6, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Private bathroom', 'bath', 'Bathroom');
INSERT INTO amenity (amenity_id, "CreatedDate", "Description", icon, name)
VALUES (7, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Private balcony', 'door-open', 'Balcony');
INSERT INTO amenity (amenity_id, "CreatedDate", "Description", icon, name)
VALUES (8, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Ocean view', 'water', 'Sea View');

INSERT INTO hotel (hotel_id, address, city, country, created_date, description, image_url, is_active, latitude, longitude, name, phone, star_rating, updated_date, website)
VALUES (1, '123 Nguyen Hue Street', 'Ho Chi Minh', 'Vietnam', TIMESTAMPTZ '2024-01-01T00:00:00Z', 'A luxurious 5-star hotel in the heart of the city with stunning views and world-class amenities.', NULL, TRUE, NULL, NULL, 'Grand Luxury Hotel', '028-1234-5678', 5.0, NULL, 'https://grandluxury.com');
INSERT INTO hotel (hotel_id, address, city, country, created_date, description, image_url, is_active, latitude, longitude, name, phone, star_rating, updated_date, website)
VALUES (2, '456 Tran Phu Street', 'Nha Trang', 'Vietnam', TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Beautiful beachfront resort with private beach access and spa facilities.', NULL, TRUE, NULL, NULL, 'Beach Paradise Resort', '0258-987-6543', 4.5, NULL, 'https://beachparadise.com');
INSERT INTO hotel (hotel_id, address, city, country, created_date, description, image_url, is_active, latitude, longitude, name, phone, star_rating, updated_date, website)
VALUES (3, '789 Hoang Dieu Street', 'Da Lat', 'Vietnam', TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Charming mountain lodge surrounded by pine forests and beautiful gardens.', NULL, TRUE, NULL, NULL, 'Mountain View Lodge', '0263-111-2222', 4.0, NULL, 'https://mountainview.com');

INSERT INTO users (user_id, address, created_date, email, first_name, hotel_id, is_active, last_name, password, phone_number, role, updated_date)
VALUES (1, NULL, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'admin@hotelbooking.com', 'Platform', NULL, TRUE, 'Admin', 'Admin@123', '0123456789', 'Admin', NULL);
INSERT INTO users (user_id, address, created_date, email, first_name, hotel_id, is_active, last_name, password, phone_number, role, updated_date)
VALUES (2, NULL, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'customer@gmail.com', 'Nguyen', NULL, TRUE, 'Van A', 'Customer@123', '0987654321', 'Customer', NULL);

INSERT INTO room_type (room_type_id, base_price, capacity, created_date, description, hotel_id, image_url, name, updated_date)
VALUES (1, 1500000.0, 2, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Comfortable room with essential amenities', 1, NULL, 'Standard Room', NULL);
INSERT INTO room_type (room_type_id, base_price, capacity, created_date, description, hotel_id, image_url, name, updated_date)
VALUES (2, 2500000.0, 2, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Spacious room with city view', 1, NULL, 'Deluxe Room', NULL);
INSERT INTO room_type (room_type_id, base_price, capacity, created_date, description, hotel_id, image_url, name, updated_date)
VALUES (3, 4500000.0, 4, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Luxury suite with living area', 1, NULL, 'Executive Suite', NULL);
INSERT INTO room_type (room_type_id, base_price, capacity, created_date, description, hotel_id, image_url, name, updated_date)
VALUES (4, 1800000.0, 2, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Room overlooking tropical gardens', 2, NULL, 'Garden View Room', NULL);
INSERT INTO room_type (room_type_id, base_price, capacity, created_date, description, hotel_id, image_url, name, updated_date)
VALUES (5, 2800000.0, 2, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Room with stunning sea views', 2, NULL, 'Ocean View Room', NULL);
INSERT INTO room_type (room_type_id, base_price, capacity, created_date, description, hotel_id, image_url, name, updated_date)
VALUES (6, 8000000.0, 6, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Private villa with beach access', 2, NULL, 'Beach Villa', NULL);
INSERT INTO room_type (room_type_id, base_price, capacity, created_date, description, hotel_id, image_url, name, updated_date)
VALUES (7, 1200000.0, 2, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Warm and cozy room with mountain view', 3, NULL, 'Cozy Room', NULL);
INSERT INTO room_type (room_type_id, base_price, capacity, created_date, description, hotel_id, image_url, name, updated_date)
VALUES (8, 2000000.0, 4, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'Large room for families', 3, NULL, 'Family Room', NULL);

INSERT INTO users (user_id, address, created_date, email, first_name, hotel_id, is_active, last_name, password, phone_number, role, updated_date)
VALUES (3, NULL, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'owner.grandluxury@hotel.com', 'Tran', 1, TRUE, 'Van B', 'Owner@123', '0912345678', 'HotelOwner', NULL);
INSERT INTO users (user_id, address, created_date, email, first_name, hotel_id, is_active, last_name, password, phone_number, role, updated_date)
VALUES (4, NULL, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'owner.beachparadise@hotel.com', 'Le', 2, TRUE, 'Thi C', 'Owner@123', '0923456789', 'HotelOwner', NULL);
INSERT INTO users (user_id, address, created_date, email, first_name, hotel_id, is_active, last_name, password, phone_number, role, updated_date)
VALUES (5, NULL, TIMESTAMPTZ '2024-01-01T00:00:00Z', 'owner.mountainview@hotel.com', 'Pham', 3, TRUE, 'Van D', 'Owner@123', '0934567890', 'HotelOwner', NULL);

INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (1, TIMESTAMPTZ '2024-01-01T00:00:00Z', 1, '101', 1, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (2, TIMESTAMPTZ '2024-01-01T00:00:00Z', 1, '102', 1, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (3, TIMESTAMPTZ '2024-01-01T00:00:00Z', 2, '201', 2, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (4, TIMESTAMPTZ '2024-01-01T00:00:00Z', 2, '202', 2, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (5, TIMESTAMPTZ '2024-01-01T00:00:00Z', 3, '301', 3, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (6, TIMESTAMPTZ '2024-01-01T00:00:00Z', 1, 'A101', 4, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (7, TIMESTAMPTZ '2024-01-01T00:00:00Z', 1, 'A102', 4, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (8, TIMESTAMPTZ '2024-01-01T00:00:00Z', 2, 'B201', 5, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (9, TIMESTAMPTZ '2024-01-01T00:00:00Z', 2, 'B202', 5, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (10, TIMESTAMPTZ '2024-01-01T00:00:00Z', 1, 'V01', 6, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (11, TIMESTAMPTZ '2024-01-01T00:00:00Z', 1, 'M101', 7, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (12, TIMESTAMPTZ '2024-01-01T00:00:00Z', 1, 'M102', 7, 'Available', NULL);
INSERT INTO room (room_id, created_date, floor, room_number, room_type_id, status, updated_date)
VALUES (13, TIMESTAMPTZ '2024-01-01T00:00:00Z', 2, 'M201', 8, 'Available', NULL);

INSERT INTO room_amenity (amenity_id, room_id)
VALUES (1, 1);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (2, 1);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (3, 1);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (1, 2);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (2, 2);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (3, 2);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (1, 3);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (2, 3);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (3, 3);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (4, 3);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (5, 3);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (1, 5);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (2, 5);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (3, 5);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (4, 5);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (5, 5);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (6, 5);
INSERT INTO room_amenity (amenity_id, room_id)
VALUES (7, 5);

CREATE INDEX "IX_booking_check_in_date" ON booking (check_in_date);

CREATE INDEX "IX_booking_check_out_date" ON booking (check_out_date);

CREATE INDEX "IX_booking_room_id" ON booking (room_id);

CREATE INDEX "IX_booking_user_id" ON booking (user_id);

CREATE UNIQUE INDEX "IX_payment_booking_id" ON payment (booking_id);

CREATE UNIQUE INDEX "IX_review_booking_id" ON review (booking_id);

CREATE INDEX "IX_review_hotel_id" ON review (hotel_id);

CREATE INDEX "IX_review_user_id" ON review (user_id);

CREATE UNIQUE INDEX "IX_room_room_number" ON room (room_number);

CREATE INDEX "IX_room_room_type_id" ON room (room_type_id);

CREATE INDEX "IX_room_amenity_amenity_id" ON room_amenity (amenity_id);

CREATE INDEX "IX_room_type_hotel_id" ON room_type (hotel_id);

CREATE UNIQUE INDEX "IX_users_email" ON users (email);

CREATE INDEX "IX_users_hotel_id" ON users (hotel_id);

SELECT setval(
    pg_get_serial_sequence('amenity', 'amenity_id'),
    GREATEST(
        (SELECT MAX(amenity_id) FROM amenity) + 1,
        nextval(pg_get_serial_sequence('amenity', 'amenity_id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('hotel', 'hotel_id'),
    GREATEST(
        (SELECT MAX(hotel_id) FROM hotel) + 1,
        nextval(pg_get_serial_sequence('hotel', 'hotel_id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('users', 'user_id'),
    GREATEST(
        (SELECT MAX(user_id) FROM users) + 1,
        nextval(pg_get_serial_sequence('users', 'user_id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('room_type', 'room_type_id'),
    GREATEST(
        (SELECT MAX(room_type_id) FROM room_type) + 1,
        nextval(pg_get_serial_sequence('room_type', 'room_type_id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('room', 'room_id'),
    GREATEST(
        (SELECT MAX(room_id) FROM room) + 1,
        nextval(pg_get_serial_sequence('room', 'room_id'))),
    false);

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20260127162737_InitialCreate', '10.0.2');

COMMIT;

